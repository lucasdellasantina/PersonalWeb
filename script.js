const translations = {
  es: {
    name: "Lucas della Santina",
    title: "Ingeniero Electr贸nico",
    subtitle: "Ciberseguridad & IoT",
    "nav-about": "Sobre M铆",
    "nav-skills": "Habilidades",
    "nav-experience": "Experiencia",
    "nav-education": "Educaci贸n",
    "nav-certifications": "Certificaciones",
    "nav-projects": "Proyectos",
    "nav-contact": "Contacto",
    "about-title": "Sobre M铆",
    "about-lead":
      "Soy un ingeniero electr贸nico apasionado por la intersecci贸n entre hardware, software y seguridad digital.",
    "about-p1":
      "Mi experiencia abarca desde el dise帽o de circuitos electr贸nicos hasta la implementaci贸n de sistemas IoT seguros. Me especializo en crear soluciones que no solo funcionan, sino que est谩n protegidas contra las amenazas cibern茅ticas modernas.",
    "about-p2":
      "Con un enfoque en la ciberseguridad aplicada a dispositivos IoT, trabajo constantemente en proyectos que combinan electr贸nica de vanguardia con protocolos de seguridad robustos. Mi objetivo es construir el futuro conectado de manera segura y eficiente.",
    "interest-electronics": "Electr贸nica",
    "interest-electronics-desc": "Dise帽o de circuitos y sistemas embebidos",
    "interest-security": "Ciberseguridad",
    "interest-security-desc": "Protecci贸n de sistemas y redes",
    "interest-iot": "IoT",
    "interest-iot-desc": "Internet de las Cosas y conectividad",
    "skills-title": "Habilidades T茅cnicas",
    "skills-electronics-title": "Electr贸nica & Hardware",
    "skills-security-title": "Ciberseguridad",
    "skills-iot-title": "IoT & Conectividad",
    "skills-programming-title": "Programaci贸n",
    "experience-title": "Experiencia",
    present: "Presente",
    "exp1-title": "Junior Security Architect",
    "exp1-company": "Banco de C贸rdoba",
    "exp1-desc":
      "Arquitectura de seguridad y dise帽o de soluciones de ciberseguridad para infraestructura bancaria. An谩lisis de vulnerabilidades y auditor铆as de seguridad.",
    "exp2-title": "Facilities Management Specialist",
    "exp2-company": "Banco de C贸rdoba",
    "exp2-desc":
      "Gesti贸n de infraestructura del centro de datos, monitoreo de sistemas y optimizaci贸n de recursos. Implementaci贸n de soluciones de automatizaci贸n.",
    "exp3-title": "Consultor Home Assistant",
    "exp3-company": "Aut贸nomo",
    "exp3-desc":
      "Consultor铆a en automatizaci贸n del hogar y sistemas IoT. Implementaci贸n de soluciones con Home Assistant, Docker y microservicios.",
    "exp4-title": "Practicante de Ingenier铆a",
    "exp4-company": "Innova Space",
    "exp4-desc":
      "Pr谩cticas profesionales en ingenier铆a aeroespacial y sistemas embebidos. Desarrollo de componentes para proyectos de investigaci贸n.",
    "education-title": "Educaci贸n",
    "edu1-title": "Grado en Ingenier铆a Electr贸nica",
    "edu1-company": "Universidad Tecnol贸gica Nacional (UTN)",
    "edu1-desc":
      "Formaci贸n integral en ingenier铆a electr贸nica con 茅nfasis en sistemas embebidos, dise帽o de circuitos y automatizaci贸n. Nota: 7.67/10",
    "edu2-title": "T茅cnico Universitario en Electr贸nica",
    "edu2-company": "Universidad Tecnol贸gica Nacional (UTN)",
    "edu2-desc":
      "Formaci贸n t茅cnica en electr贸nica con aplicaciones pr谩cticas en automatizaci贸n y control. Nota: 7.51/10",
    "edu3-title": "T茅cnico de Nivel Medio en Electr贸nica",
    "edu3-company": 'I.P.E.T. N掳 51 "Nicol谩s Avellaneda"',
    "edu3-desc":
      "Educaci贸n secundaria obligatoria con especializaci贸n t茅cnica en electr贸nica. Formaci贸n en dise帽o CAD y circuitos.",
    "edu4-title": "Ingenier铆a Industrial (En Curso)",
    "edu4-company": "Universidad Tecnol贸gica Nacional (UTN)",
    "edu4-desc":
      "Estudiante avanzado de Ingenier铆a Industrial. Complementando formaci贸n con gesti贸n, optimizaci贸n de procesos y termodin谩mica.",
    "certifications-title": "Certificaciones",
    "projects-title": "Proyectos Destacados",
    "project1-title": "Sistema de Seguridad IoT",
    "project1-desc":
      "Plataforma completa de seguridad para dispositivos IoT con detecci贸n de intrusiones, an谩lisis de tr谩fico en tiempo real y alertas autom谩ticas.",
    "project2-title": "Red de Sensores Ambientales",
    "project2-desc":
      "Red distribuida de sensores IoT para monitoreo ambiental con comunicaci贸n LoRaWAN y visualizaci贸n de datos en tiempo real.",
    "project3-title": "Herramienta de Pentesting IoT",
    "project3-desc":
      "Suite de herramientas para an谩lisis de seguridad y pentesting espec铆fico para dispositivos IoT y protocolos de comunicaci贸n.",
    "project4-title": "Gateway IoT Seguro",
    "project4-desc":
      "Gateway personalizado con cifrado end-to-end para comunicaci贸n segura entre dispositivos IoT y la nube.",
    "contact-title": "Contacto",
    "contact-text":
      "驴Tienes un proyecto interesante en mente? 驴Necesitas consultor铆a en ciberseguridad o IoT? Me encantar铆a escuchar sobre tu idea y ver c贸mo puedo ayudarte.",
    "contact-github": "Ver en GitHub",
    "contact-linkedin": "Conectar en LinkedIn",
    "footer-text": "Dise帽ado y construido con pasi贸n por la tecnolog铆a",
  },
  en: {
    name: "Lucas della Santina",
    title: "Electronic Engineer",
    subtitle: "Cybersecurity & IoT",
    "nav-about": "About",
    "nav-skills": "Skills",
    "nav-experience": "Experience",
    "nav-education": "Education",
    "nav-certifications": "Certifications",
    "nav-projects": "Projects",
    "nav-contact": "Contact",
    "about-title": "About Me",
    "about-lead":
      "I am an electronic engineer passionate about the intersection of hardware, software, and digital security.",
    "about-p1":
      "My experience ranges from electronic circuit design to implementing secure IoT systems. I specialize in creating solutions that not only work but are protected against modern cyber threats.",
    "about-p2":
      "With a focus on cybersecurity applied to IoT devices, I constantly work on projects that combine cutting-edge electronics with robust security protocols. My goal is to build the connected future in a secure and efficient way.",
    "interest-electronics": "Electronics",
    "interest-electronics-desc": "Circuit design and embedded systems",
    "interest-security": "Cybersecurity",
    "interest-security-desc": "System and network protection",
    "interest-iot": "IoT",
    "interest-iot-desc": "Internet of Things and connectivity",
    "skills-title": "Technical Skills",
    "skills-electronics-title": "Electronics & Hardware",
    "skills-security-title": "Cybersecurity",
    "skills-iot-title": "IoT & Connectivity",
    "skills-programming-title": "Programming",
    "experience-title": "Experience",
    present: "Present",
    "exp1-title": "Junior Security Architect",
    "exp1-company": "Banco de C贸rdoba",
    "exp1-desc":
      "Security architecture and cybersecurity solutions design for banking infrastructure. Vulnerability analysis and security audits.",
    "exp2-title": "Facilities Management Specialist",
    "exp2-company": "Banco de C贸rdoba",
    "exp2-desc":
      "Data center infrastructure management, systems monitoring and resource optimization. Implementation of automation solutions.",
    "exp3-title": "Home Assistant Consultant",
    "exp3-company": "Freelance",
    "exp3-desc":
      "Consulting in home automation and IoT systems. Implementation of solutions with Home Assistant, Docker and microservices.",
    "exp4-title": "Engineering Intern",
    "exp4-company": "Innova Space",
    "exp4-desc":
      "Professional internship in aerospace engineering and embedded systems. Development of components for research projects.",
    "education-title": "Education",
    "edu1-title": "Degree in Electronic Engineering",
    "edu1-company": "National Technological University (UTN)",
    "edu1-desc":
      "Comprehensive training in electronic engineering with emphasis on embedded systems, circuit design and automation. Grade: 7.67/10",
    "edu2-title": "University Technician in Electronics",
    "edu2-company": "National Technological University (UTN)",
    "edu2-desc":
      "Technical training in electronics with practical applications in automation and control. Grade: 7.51/10",
    "edu3-title": "Mid-Level Technician in Electronics",
    "edu3-company": 'I.P.E.T. N掳 51 "Nicol谩s Avellaneda"',
    "edu3-desc":
      "Compulsory secondary education with technical specialization in electronics. Training in CAD design and circuits.",
    "edu4-title": "Industrial Engineering (In Progress)",
    "edu4-company": "National Technological University (UTN)",
    "edu4-desc":
      "Advanced student of Industrial Engineering. Complementing training with management, process optimization and thermodynamics.",
    "certifications-title": "Certifications",
    "projects-title": "Featured Projects",
    "project1-title": "IoT Security System",
    "project1-desc":
      "Complete security platform for IoT devices with intrusion detection, real-time traffic analysis and automatic alerts.",
    "project2-title": "Environmental Sensor Network",
    "project2-desc":
      "Distributed IoT sensor network for environmental monitoring with LoRaWAN communication and real-time data visualization.",
    "project3-title": "IoT Pentesting Tool",
    "project3-desc":
      "Suite of tools for security analysis and pentesting specific to IoT devices and communication protocols.",
    "project4-title": "Secure IoT Gateway",
    "project4-desc":
      "Custom gateway with end-to-end encryption for secure communication between IoT devices and the cloud.",
    "contact-title": "Contact",
    "contact-text":
      "Do you have an interesting project in mind? Need consulting in cybersecurity or IoT? I would love to hear about your idea and see how I can help.",
    "contact-github": "View on GitHub",
    "contact-linkedin": "Connect on LinkedIn",
    "footer-text": "Designed and built with passion for technology",
  },
}

let currentLang = "es"

/**
 * Refactored to use .dataset instead of getAttribute for better performance
 * Changes the application language
 * @param {string} lang - Language code (es or en)
 */
function changeLanguage(lang) {
  if (!translations[lang]) {
    console.error(`[v0] Language '${lang}' not found`)
    return
  }

  currentLang = lang
  document.documentElement.lang = lang

  // Update all elements with data-i18n attribute
  document.querySelectorAll("[data-i18n]").forEach((element) => {
    const key = element.dataset.i18n
    if (translations[lang][key]) {
      element.textContent = translations[lang][key]
    } else {
      console.warn(`[v0] Translation key '${key}' not found for language '${lang}'`)
    }
  })

  // Update active button
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    const isActive = btn.dataset.lang === lang
    btn.classList.toggle("active", isActive)
    btn.setAttribute("aria-pressed", isActive)
  })

  // Save preference
  try {
    localStorage.setItem("preferredLanguage", lang)
  } catch (error) {
    console.warn("[v0] localStorage not available:", error)
  }
}

/**
 * Extracted common event listener setup to reduce code duplication
 * Attaches click event listeners to language buttons
 */
function setupLanguageButtons() {
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang
      changeLanguage(lang)
    })
  })
}

/**
 * Extracted navigation setup to reduce code duplication
 * Sets up smooth scrolling for navigation links
 */
function setupNavigation() {
  document.querySelectorAll(".nav-link").forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault()
      const targetId = link.getAttribute("href")
      const targetSection = document.querySelector(targetId)

      if (targetSection) {
        targetSection.scrollIntoView({
          behavior: "smooth",
          block: "start",
        })

        // Update active nav link
        document.querySelectorAll(".nav-link").forEach((l) => l.classList.remove("active"))
        link.classList.add("active")
      } else {
        console.warn(`[v0] Target section '${targetId}' not found`)
      }
    })
  })
}

/**
 * Extracted scroll observer setup to reduce code duplication
 * Sets up intersection observer for fade-in animations
 */
function setupScrollObserver() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -100px 0px",
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = "1"
        entry.target.style.transform = "translateY(0)"
      }
    })
  }, observerOptions)

  document.querySelectorAll(".section").forEach((section) => {
    observer.observe(section)
  })
}

/**
 * Extracted active nav link update to reduce code duplication
 * Updates the active navigation link based on scroll position
 */
function updateActiveNavLink() {
  const sections = document.querySelectorAll(".section")
  const navLinks = document.querySelectorAll(".nav-link")
  let current = ""

  sections.forEach((section) => {
    const sectionTop = section.offsetTop
    const sectionHeight = section.clientHeight
    if (window.pageYOffset >= sectionTop - 200) {
      current = section.getAttribute("id")
    }
  })

  navLinks.forEach((link) => {
    link.classList.remove("active")
    if (link.getAttribute("href") === `#${current}`) {
      link.classList.add("active")
    }
  })
}

document.addEventListener("DOMContentLoaded", () => {
  setupLanguageButtons()

  // Load saved language preference
  try {
    const savedLang = localStorage.getItem("preferredLanguage")
    if (savedLang && translations[savedLang]) {
      changeLanguage(savedLang)
    }
  } catch (error) {
    console.warn("[v0] Could not load language preference:", error)
  }

  setupNavigation()
  setupScrollObserver()

  // Setup scroll event listener for active nav link
  let scrollTimeout
  window.addEventListener("scroll", () => {
    clearTimeout(scrollTimeout)
    scrollTimeout = setTimeout(updateActiveNavLink, 50)
  })

  // Initialize particles
  new ParticlesBackground("particles-canvas")(
    // Microsoft Clarity Analytics
    (globalScope, doc, apiName, scriptTag, trackingId) => {
      // Initialize clarity array if not exists
      if (!globalScope[apiName]) {
        globalScope[apiName] = () => {
          const queue = globalScope[apiName].q || []
          queue.push(arguments)
          globalScope[apiName].q = queue
        }
      }

      // Create and configure script element
      const clarityScript = doc.createElement(scriptTag)
      clarityScript.async = true
      clarityScript.src = "https://www.clarity.ms/tag/" + trackingId

      // Insert script into DOM
      const firstScript = doc.getElementsByTagName(scriptTag)[0]
      if (firstScript && firstScript.parentNode) {
        firstScript.parentNode.insertBefore(clarityScript, firstScript)
      }
    },
  )(
    globalThis,
    document,
    "clarity",
    "script",
    "rz1pnv8gvy",
  )(
    // Device Fingerprinting
    async function initFingerprint() {
      try {
        const opjs = window.opjs || window.msOpjs
        const fp = await opjs({ API_KEY: "public_8W5zJQ1h-8vCOTFEOd3CO44ZZB8Iyu2pwQG" })
        console.log("[v0] Device Fingerprint ID:", fp.visitorId)
      } catch (error) {
        console.warn("[v0] Fingerprint initialization failed:", error)
      }
    },
  )()
})

/**
 * Improved ParticlesBackground class with better security and performance
 * Manages animated particle background with constellation effect
 */
class ParticlesBackground {
  constructor(canvasId) {
    this.canvas = document.getElementById(canvasId)
    if (!this.canvas) return

    this.ctx = this.canvas.getContext("2d")
    this.particles = []
    this.particleCount = 50
    this.connectionDistance = 150

    this.resize()
    this.init()
    this.animate()

    window.addEventListener("resize", () => this.resize())
  }

  resize() {
    this.canvas.width = window.innerWidth
    this.canvas.height = window.innerHeight
  }

  /**
   * Improved init() with better random number generation
   * Initializes particles with random positions and velocities
   */
  init() {
    this.particles = []
    const crypto = window.crypto || window.msCrypto
    const randomArray = new Uint32Array(this.particleCount * 5)

    // Use crypto.getRandomValues() for better randomness when available
    if (crypto && crypto.getRandomValues) {
      try {
        crypto.getRandomValues(randomArray)
      } catch (e) {
        console.warn("[v0] Crypto API not available, falling back to Math.random()")
      }
    }

    for (let i = 0; i < this.particleCount; i++) {
      // Use crypto values if available, otherwise fall back to Math.random()
      const useRandom = !crypto || !crypto.getRandomValues
      const getRandom = () =>
        useRandom ? Math.random() : randomArray[i * 5 + Math.floor(Math.random() * 5)] / 0xffffffff

      this.particles.push({
        x: getRandom() * this.canvas.width,
        y: getRandom() * this.canvas.height,
        vx: (getRandom() - 0.5) * 0.5,
        vy: (getRandom() - 0.5) * 0.5,
        radius: getRandom() * 1.5 + 0.5,
        opacity: getRandom() * 0.5 + 0.3,
      })
    }
  }

  update() {
    this.particles.forEach((particle) => {
      particle.x += particle.vx
      particle.y += particle.vy

      // Wrap around edges
      if (particle.x < 0) particle.x = this.canvas.width
      if (particle.x > this.canvas.width) particle.x = 0
      if (particle.y < 0) particle.y = this.canvas.height
      if (particle.y > this.canvas.height) particle.y = 0
    })
  }

  draw() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)

    // Draw particles
    this.particles.forEach((particle) => {
      this.ctx.fillStyle = `rgba(0, 217, 255, ${particle.opacity})`
      this.ctx.beginPath()
      this.ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2)
      this.ctx.fill()
    })

    // Draw connections
    for (let i = 0; i < this.particles.length; i++) {
      for (let j = i + 1; j < this.particles.length; j++) {
        const dx = this.particles[i].x - this.particles[j].x
        const dy = this.particles[i].y - this.particles[j].y
        const distance = Math.sqrt(dx * dx + dy * dy)

        if (distance < this.connectionDistance) {
          const opacity = (1 - distance / this.connectionDistance) * 0.3
          this.ctx.strokeStyle = `rgba(0, 255, 136, ${opacity})`
          this.ctx.lineWidth = 1
          this.ctx.beginPath()
          this.ctx.moveTo(this.particles[i].x, this.particles[i].y)
          this.ctx.lineTo(this.particles[j].x, this.particles[j].y)
          this.ctx.stroke()
        }
      }
    }
  }

  animate() {
    this.update()
    this.draw()
    requestAnimationFrame(() => this.animate())
  }
}

setTimeout(() => {
  console.log("%c隆Detente!", "color: red; font-size: 40px; font-weight: bold;")
  console.log(
    "%cEsta funci贸n del navegador est谩 pensada para desarrolladores.\n" +
      "Si alguien te indic贸 que copiaras y pegaras algo aqu铆 para habilitar una funci贸n, se trata de un fraude.\n\n" +
      "Si lo haces, esta persona podr谩 acceder a tu cuenta.\n\n" +
      "Obt茅n m谩s informaci贸n buscando acerca de SelfXSS",
    "font-size: 16px; color: #ff6b6b;",
  )
}, 0)

console.log("%c隆Hola Developer! ", "color: #00d9ff; font-size: 20px; font-weight: bold;")
console.log(
  "%cSi est谩s viendo esto, probablemente te guste la tecnolog铆a tanto como a m铆.",
  "color: #8892b0; font-size: 14px;",
)
console.log("%c隆Conectemos! ", "color: #00ff88; font-size: 16px; font-weight: bold;")
