const translations = {
  es: {
    name: "Lucas della Santina",
    title: "Ingeniero Electrónico",
    subtitle: "Ciberseguridad & IoT",
    "nav-about": "Sobre Mí",
    "nav-skills": "Habilidades",
    "nav-experience": "Experiencia",
    "nav-education": "Educación",
    "nav-certifications": "Certificaciones",
    "nav-projects": "Proyectos",
    "nav-contact": "Contacto",
    "about-title": "Sobre Mí",
    "about-lead":
      "Soy un ingeniero electrónico apasionado por la intersección entre hardware, software y seguridad digital.",
    "about-p1":
      "Mi experiencia abarca desde el diseño de circuitos electrónicos hasta la implementación de sistemas IoT seguros. Me especializo en crear soluciones que no solo funcionan, sino que están protegidas contra las amenazas cibernéticas modernas.",
    "about-p2":
      "Con un enfoque en la ciberseguridad aplicada a dispositivos IoT, trabajo constantemente en proyectos que combinan electrónica de vanguardia con protocolos de seguridad robustos. Mi objetivo es construir el futuro conectado de manera segura y eficiente.",
    "interest-electronics": "Electrónica",
    "interest-electronics-desc": "Diseño de circuitos y sistemas embebidos",
    "interest-security": "Ciberseguridad",
    "interest-security-desc": "Protección de sistemas y redes",
    "interest-iot": "IoT",
    "interest-iot-desc": "Internet de las Cosas y conectividad",
    "skills-title": "Habilidades Técnicas",
    "skills-electronics-title": "Electrónica & Hardware",
    "skills-security-title": "Ciberseguridad",
    "skills-iot-title": "IoT & Conectividad",
    "skills-programming-title": "Programación",
    "experience-title": "Experiencia",
    present: "Presente",
    "exp1-title": "Junior Security Architect",
    "exp1-company": "Banco de Córdoba",
    "exp1-desc":
      "Arquitectura de seguridad y diseño de soluciones de ciberseguridad para infraestructura bancaria. Análisis de vulnerabilidades y auditorías de seguridad.",
    "exp2-title": "Facilities Management Specialist",
    "exp2-company": "Banco de Córdoba",
    "exp2-desc":
      "Gestión de infraestructura del centro de datos, monitoreo de sistemas y optimización de recursos. Implementación de soluciones de automatización.",
    "exp3-title": "Consultor Home Assistant",
    "exp3-company": "Autónomo",
    "exp3-desc":
      "Consultoría en automatización del hogar y sistemas IoT. Implementación de soluciones con Home Assistant, Docker y microservicios.",
    "exp4-title": "Practicante de Ingeniería",
    "exp4-company": "Innova Space",
    "exp4-desc":
      "Prácticas profesionales en ingeniería aeroespacial y sistemas embebidos. Desarrollo de componentes para proyectos de investigación.",
    "education-title": "Educación",
    "edu1-title": "Grado en Ingeniería Electrónica",
    "edu1-company": "Universidad Tecnológica Nacional (UTN)",
    "edu1-desc":
      "Formación integral en ingeniería electrónica con énfasis en sistemas embebidos, diseño de circuitos y automatización. Nota: 7.67/10",
    "edu2-title": "Técnico Universitario en Electrónica",
    "edu2-company": "Universidad Tecnológica Nacional (UTN)",
    "edu2-desc":
      "Formación técnica en electrónica con aplicaciones prácticas en automatización y control. Nota: 7.51/10",
    "edu3-title": "Técnico de Nivel Medio en Electrónica",
    "edu3-company": 'I.P.E.T. N° 51 "Nicolás Avellaneda"',
    "edu3-desc":
      "Educación secundaria obligatoria con especialización técnica en electrónica. Formación en diseño CAD y circuitos.",
    "edu4-title": "Ingeniería Industrial (En Curso)",
    "edu4-company": "Universidad Tecnológica Nacional (UTN)",
    "edu4-desc":
      "Estudiante avanzado de Ingeniería Industrial. Complementando formación con gestión, optimización de procesos y termodinámica.",
    "certifications-title": "Certificaciones",
    "projects-title": "Proyectos Destacados",
    "project1-title": "Sistema de Seguridad IoT",
    "project1-desc":
      "Plataforma completa de seguridad para dispositivos IoT con detección de intrusiones, análisis de tráfico en tiempo real y alertas automáticas.",
    "project2-title": "Red de Sensores Ambientales",
    "project2-desc":
      "Red distribuida de sensores IoT para monitoreo ambiental con comunicación LoRaWAN y visualización de datos en tiempo real.",
    "project3-title": "Herramienta de Pentesting IoT",
    "project3-desc":
      "Suite de herramientas para análisis de seguridad y pentesting específico para dispositivos IoT y protocolos de comunicación.",
    "project4-title": "Gateway IoT Seguro",
    "project4-desc":
      "Gateway personalizado con cifrado end-to-end para comunicación segura entre dispositivos IoT y la nube.",
    "contact-title": "Contacto",
    "contact-text":
      "¿Tienes un proyecto interesante en mente? ¿Necesitas consultoría en ciberseguridad o IoT? Me encantaría escuchar sobre tu idea y ver cómo puedo ayudarte.",
    "contact-github": "Ver en GitHub",
    "contact-linkedin": "Conectar en LinkedIn",
    "footer-text": "Diseñado y construido con pasión por la tecnología",
  },
  en: {
    name: "Lucas della Santina",
    title: "Electronic Engineer",
    subtitle: "Cybersecurity & IoT",
    "nav-about": "About",
    "nav-skills": "Skills",
    "nav-experience": "Experience",
    "nav-education": "Education",
    "nav-certifications": "Certifications",
    "nav-projects": "Projects",
    "nav-contact": "Contact",
    "about-title": "About Me",
    "about-lead":
      "I am an electronic engineer passionate about the intersection of hardware, software, and digital security.",
    "about-p1":
      "My experience ranges from electronic circuit design to implementing secure IoT systems. I specialize in creating solutions that not only work but are protected against modern cyber threats.",
    "about-p2":
      "With a focus on cybersecurity applied to IoT devices, I constantly work on projects that combine cutting-edge electronics with robust security protocols. My goal is to build the connected future in a secure and efficient way.",
    "interest-electronics": "Electronics",
    "interest-electronics-desc": "Circuit design and embedded systems",
    "interest-security": "Cybersecurity",
    "interest-security-desc": "System and network protection",
    "interest-iot": "IoT",
    "interest-iot-desc": "Internet of Things and connectivity",
    "skills-title": "Technical Skills",
    "skills-electronics-title": "Electronics & Hardware",
    "skills-security-title": "Cybersecurity",
    "skills-iot-title": "IoT & Connectivity",
    "skills-programming-title": "Programming",
    "experience-title": "Experience",
    present: "Present",
    "exp1-title": "Junior Security Architect",
    "exp1-company": "Banco de Córdoba",
    "exp1-desc":
      "Security architecture and cybersecurity solutions design for banking infrastructure. Vulnerability analysis and security audits.",
    "exp2-title": "Facilities Management Specialist",
    "exp2-company": "Banco de Córdoba",
    "exp2-desc":
      "Data center infrastructure management, systems monitoring and resource optimization. Implementation of automation solutions.",
    "exp3-title": "Home Assistant Consultant",
    "exp3-company": "Freelance",
    "exp3-desc":
      "Consulting in home automation and IoT systems. Implementation of solutions with Home Assistant, Docker and microservices.",
    "exp4-title": "Engineering Intern",
    "exp4-company": "Innova Space",
    "exp4-desc":
      "Professional internship in aerospace engineering and embedded systems. Development of components for research projects.",
    "education-title": "Education",
    "edu1-title": "Degree in Electronic Engineering",
    "edu1-company": "National Technological University (UTN)",
    "edu1-desc":
      "Comprehensive training in electronic engineering with emphasis on embedded systems, circuit design and automation. Grade: 7.67/10",
    "edu2-title": "University Technician in Electronics",
    "edu2-company": "National Technological University (UTN)",
    "edu2-desc":
      "Technical training in electronics with practical applications in automation and control. Grade: 7.51/10",
    "edu3-title": "Mid-Level Technician in Electronics",
    "edu3-company": 'I.P.E.T. N° 51 "Nicolás Avellaneda"',
    "edu3-desc":
      "Compulsory secondary education with technical specialization in electronics. Training in CAD design and circuits.",
    "edu4-title": "Industrial Engineering (In Progress)",
    "edu4-company": "National Technological University (UTN)",
    "edu4-desc":
      "Advanced student of Industrial Engineering. Complementing training with management, process optimization and thermodynamics.",
    "certifications-title": "Certifications",
    "projects-title": "Featured Projects",
    "project1-title": "IoT Security System",
    "project1-desc":
      "Complete security platform for IoT devices with intrusion detection, real-time traffic analysis and automatic alerts.",
    "project2-title": "Environmental Sensor Network",
    "project2-desc":
      "Distributed IoT sensor network for environmental monitoring with LoRaWAN communication and real-time data visualization.",
    "project3-title": "IoT Pentesting Tool",
    "project3-desc":
      "Suite of tools for security analysis and pentesting specific to IoT devices and communication protocols.",
    "project4-title": "Secure IoT Gateway",
    "project4-desc":
      "Custom gateway with end-to-end encryption for secure communication between IoT devices and the cloud.",
    "contact-title": "Contact",
    "contact-text":
      "Do you have an interesting project in mind? Need consulting in cybersecurity or IoT? I would love to hear about your idea and see how I can help.",
    "contact-github": "View on GitHub",
    "contact-linkedin": "Connect on LinkedIn",
    "footer-text": "Designed and built with passion for technology",
  },
}

let currentLang = "es"

/**
 * Refactored to use .dataset instead of getAttribute for better performance
 * Changes the application language
 * @param {string} lang - Language code (es or en)
 */
function changeLanguage(lang) {
  if (!translations[lang]) {
    console.error(`[v0] Language '${lang}' not found`)
    return
  }

  currentLang = lang
  document.documentElement.lang = lang

  // Update all elements with data-i18n attribute
  document.querySelectorAll("[data-i18n]").forEach((element) => {
    const key = element.dataset.i18n
    if (translations[lang][key]) {
      element.textContent = translations[lang][key]
    } else {
      console.warn(`[v0] Translation key '${key}' not found for language '${lang}'`)
    }
  })

  // Update active button
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    const isActive = btn.dataset.lang === lang
    btn.classList.toggle("active", isActive)
    btn.setAttribute("aria-pressed", isActive)
  })

  // Save preference
  try {
    localStorage.setItem("preferredLanguage", lang)
  } catch (error) {
    console.warn("[v0] localStorage not available:", error)
  }
}

/**
 * Extracted common event listener setup to reduce code duplication
 * Attaches click event listeners to language buttons
 */
function setupLanguageButtons() {
  document.querySelectorAll(".lang-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.lang
      changeLanguage(lang)
    })
  })
}

/**
 * Extracted navigation setup to reduce code duplication
 * Sets up smooth scrolling for navigation links
 */
function setupNavigation() {
  document.querySelectorAll(".nav-link").forEach((link) => {
    link.addEventListener("click", (e) => {
      e.preventDefault()
      const targetId = link.getAttribute("href")
      const targetSection = document.querySelector(targetId)

      if (targetSection) {
        targetSection.scrollIntoView({
          behavior: "smooth",
          block: "start",
        })

        // Update active nav link
        document.querySelectorAll(".nav-link").forEach((l) => l.classList.remove("active"))
        link.classList.add("active")
      } else {
        console.warn(`[v0] Target section '${targetId}' not found`)
      }
    })
  })
}

/**
 * Extracted scroll observer setup to reduce code duplication
 * Sets up intersection observer for fade-in animations
 */
function setupScrollObserver() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -100px 0px",
  }

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.style.opacity = "1"
        entry.target.style.transform = "translateY(0)"
      }
    })
  }, observerOptions)

  document.querySelectorAll(".section").forEach((section) => {
    observer.observe(section)
  })
}

/**
 * Extracted active nav link update to reduce code duplication
 * Updates the active navigation link based on scroll position
 */
function updateActiveNavLink() {
  const sections = document.querySelectorAll(".section")
  const navLinks = document.querySelectorAll(".nav-link")
  let current = ""

  sections.forEach((section) => {
    const sectionTop = section.offsetTop
    const sectionHeight = section.clientHeight
    if (window.pageYOffset >= sectionTop - 200) {
      current = section.getAttribute("id")
    }
  })

  navLinks.forEach((link) => {
    link.classList.remove("active")
    if (link.getAttribute("href") === `#${current}`) {
      link.classList.add("active")
    }
  })
}

document.addEventListener("DOMContentLoaded", () => {
  setupLanguageButtons()

  // Load saved language preference
  try {
    const savedLang = localStorage.getItem("preferredLanguage")
    if (savedLang && translations[savedLang]) {
      changeLanguage(savedLang)
    }
  } catch (error) {
    console.warn("[v0] Could not load language preference:", error)
  }

  setupNavigation()
  setupScrollObserver()

  // Setup scroll event listener for active nav link
  let scrollTimeout
  window.addEventListener("scroll", () => {
    clearTimeout(scrollTimeout)
    scrollTimeout = setTimeout(updateActiveNavLink, 50)
  })

  // Initialize particles
  new ParticlesBackground("particles-canvas")(
    // Microsoft Clarity Analytics
    (globalScope, doc, apiName, scriptTag, trackingId) => {
      // Initialize clarity array if not exists
      if (!globalScope[apiName]) {
        globalScope[apiName] = () => {
          const queue = globalScope[apiName].q || []
          queue.push(arguments)
          globalScope[apiName].q = queue
        }
      }

      // Create and configure script element
      const clarityScript = doc.createElement(scriptTag)
      clarityScript.async = true
      clarityScript.src = "https://www.clarity.ms/tag/" + trackingId

      // Insert script into DOM
      const firstScript = doc.getElementsByTagName(scriptTag)[0]
      if (firstScript && firstScript.parentNode) {
        firstScript.parentNode.insertBefore(clarityScript, firstScript)
      }
    },
  )(
    globalThis,
    document,
    "clarity",
    "script",
    "rz1pnv8gvy",
  )(
    // Device Fingerprinting
    async function initFingerprint() {
      try {
        const opjs = window.opjs || window.msOpjs
        const fp = await opjs({ API_KEY: "public_8W5zJQ1h-8vCOTFEOd3CO44ZZB8Iyu2pwQG" })
        console.log("[v0] Device Fingerprint ID:", fp.visitorId)
      } catch (error) {
        console.warn("[v0] Fingerprint initialization failed:", error)
      }
    },
  )()
})

/**
 * Improved ParticlesBackground class with better security and performance
 * Manages animated particle background with constellation effect
 */
class ParticlesBackground {
  constructor(canvasId) {
    this.canvas = document.getElementById(canvasId)
    if (!this.canvas) return

    this.ctx = this.canvas.getContext("2d")
    this.particles = []
    this.particleCount = 50
    this.connectionDistance = 150

    this.resize()
    this.init()
    this.animate()

    window.addEventListener("resize", () => this.resize())
  }

  resize() {
    this.canvas.width = window.innerWidth
    this.canvas.height = window.innerHeight
  }

  /**
   * Improved init() with better random number generation
   * Initializes particles with random positions and velocities
   */
  init() {
    this.particles = []
    const crypto = window.crypto || window.msCrypto
    const randomArray = new Uint32Array(this.particleCount * 5)

    // Use crypto.getRandomValues() for better randomness when available
    if (crypto && crypto.getRandomValues) {
      try {
        crypto.getRandomValues(randomArray)
      } catch (e) {
        console.warn("[v0] Crypto API not available, falling back to Math.random()")
      }
    }

    for (let i = 0; i < this.particleCount; i++) {
      // Use crypto values if available, otherwise fall back to Math.random()
      const useRandom = !crypto || !crypto.getRandomValues
      const getRandom = () =>
        useRandom ? Math.random() : randomArray[i * 5 + Math.floor(Math.random() * 5)] / 0xffffffff

      this.particles.push({
        x: getRandom() * this.canvas.width,
        y: getRandom() * this.canvas.height,
        vx: (getRandom() - 0.5) * 0.5,
        vy: (getRandom() - 0.5) * 0.5,
        radius: getRandom() * 1.5 + 0.5,
        opacity: getRandom() * 0.5 + 0.3,
      })
    }
  }

  update() {
    this.particles.forEach((particle) => {
      particle.x += particle.vx
      particle.y += particle.vy

      // Wrap around edges
      if (particle.x < 0) particle.x = this.canvas.width
      if (particle.x > this.canvas.width) particle.x = 0
      if (particle.y < 0) particle.y = this.canvas.height
      if (particle.y > this.canvas.height) particle.y = 0
    })
  }

  draw() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)

    // Draw particles
    this.particles.forEach((particle) => {
      this.ctx.fillStyle = `rgba(0, 217, 255, ${particle.opacity})`
      this.ctx.beginPath()
      this.ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2)
      this.ctx.fill()
    })

    // Draw connections
    for (let i = 0; i < this.particles.length; i++) {
      for (let j = i + 1; j < this.particles.length; j++) {
        const dx = this.particles[i].x - this.particles[j].x
        const dy = this.particles[i].y - this.particles[j].y
        const distance = Math.sqrt(dx * dx + dy * dy)

        if (distance < this.connectionDistance) {
          const opacity = (1 - distance / this.connectionDistance) * 0.3
          this.ctx.strokeStyle = `rgba(0, 255, 136, ${opacity})`
          this.ctx.lineWidth = 1
          this.ctx.beginPath()
          this.ctx.moveTo(this.particles[i].x, this.particles[i].y)
          this.ctx.lineTo(this.particles[j].x, this.particles[j].y)
          this.ctx.stroke()
        }
      }
    }
  }

  animate() {
    this.update()
    this.draw()
    requestAnimationFrame(() => this.animate())
  }
}

setTimeout(() => {
  console.log("%c¡Detente!", "color: red; font-size: 40px; font-weight: bold;")
  console.log(
    "%cEsta función del navegador está pensada para desarrolladores.\n" +
      "Si alguien te indicó que copiaras y pegaras algo aquí para habilitar una función, se trata de un fraude.\n\n" +
      "Si lo haces, esta persona podrá acceder a tu cuenta.\n\n" +
      "Obtén más información buscando acerca de SelfXSS",
    "font-size: 16px; color: #ff6b6b;",
  )
}, 0)

console.log("%c¡Hola Developer! 👋", "color: #00d9ff; font-size: 20px; font-weight: bold;")
console.log(
  "%cSi estás viendo esto, probablemente te guste la tecnología tanto como a mí.",
  "color: #8892b0; font-size: 14px;",
)
console.log("%c¡Conectemos! 🚀", "color: #00ff88; font-size: 16px; font-weight: bold;")
